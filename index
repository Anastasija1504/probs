<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–ü–µ—Ä–µ–≤–µ—Ä–Ω–∏ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å ‚Äî –≥—Ä–∞</title>

  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#7dd3fc;--accent2:#a78bfa;--glass: rgba(255,255,255,0.04)}
    *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,'Helvetica Neue',Arial}
    body{margin:0;min-height:100vh;background:linear-gradient(180deg,#071023 0%, #071a2a 60%), radial-gradient(600px 300px at 10% 20%, rgba(122,85,255,0.07), transparent);color:#e6eef8;display:flex;align-items:center;justify-content:center;padding:28px}
    .app{width:980px;max-width:96%;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:18px;padding:22px;box-shadow:0 10px 30px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.03)}
    header{display:flex;align-items:center;gap:16px;margin-bottom:14px}
    .logo{width:64px;height:64px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:700;color:#04263b;box-shadow:0 6px 20px rgba(120,63,255,0.12)}
    h1{font-size:20px;margin:0}
    p.lead{margin:0;color:rgba(230,238,248,0.75)}

    .grid{display:grid;grid-template-columns:1fr 360px;gap:18px}

    .card{background:var(--card);padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}

    .controls{display:flex;flex-direction:column;gap:10px}
    /* –ê–Ω—ñ–º–∞—Ü—ñ—è: –±–ª–æ–∫ —Å—ñ—Ä—ñ—à–∞—î —ñ –∑–Ω–∏–∫–∞—î */
    .controls-fade{
      filter: grayscale(1);
      opacity: 0;
      transition: filter 0.6s ease, opacity 0.6s ease;
    }

    label{font-size:13px;color:rgba(230,238,248,0.8)}
    input[type=text]{padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;font-size:15px}
    .btn{appearance:none;border:0;padding:11px 14px;border-radius:10px;font-weight:600;cursor:pointer}
    .btn-primary{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#022235}

    .stage{height:240px;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:12px}

    .sequence-box{
      width:320px;
      height:120px;
      border-radius:12px;
      background:var(--glass);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:62px;
      letter-spacing:8px;
      color:rgba(255,255,255,0.95);
      text-align:center;
    }

    .sequence-box.small-text{
      font-size:20px !important;
      letter-spacing:1px !important;
      line-height:1.2;
      padding:10px;
    }

    .digit{
      width:84px;
      height:84px;
      border-radius:12px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:36px;
    }

    .glow{animation:glow 700ms ease-in-out;box-shadow:0 12px 40px rgba(125,211,252,0.18), inset 0 -8px 20px rgba(167,139,250,0.06)}
    @keyframes glow{0%{transform:scale(0.9);opacity:0.2}50%{transform:scale(1.05);opacity:1}100%{transform:scale(1);opacity:1}}

    .info-row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .pill{padding:6px 10px;border-radius:999px;background:rgba(255,255,255,0.03);font-weight:600}

    .footer-stats{display:flex;gap:12px;margin-top:12px;align-items:center}
    .small{font-size:13px;color:rgba(230,238,248,0.7)}

    .result{font-size:16px;font-weight:700}

    .history{max-height:220px;overflow:auto;padding-right:8px}
    .round-item{padding:8px;border-radius:8px;margin-bottom:8px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));border:1px solid rgba(255,255,255,0.02);display:flex;justify-content:space-between;align-items:center}

    footer.note{margin-top:12px;font-size:13px;color:rgba(230,238,248,0.6)}

    @media (max-width:880px){.grid{grid-template-columns:1fr}}
  </style>
</head>

<body>
  <div class="app" role="application">
    <header>
      <div class="logo">RS</div>
      <div>
        <h1>–ü–µ—Ä–µ–≤–µ—Ä–Ω–∏ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å</h1>
        <p class="lead">–î–∏–≤–∏—Å—å —á–∏—Å–ª–∞, –ø–æ—Ç—ñ–º –≤–≤–µ–¥–∏ —ó—Ö —É –∑–≤–æ—Ä–æ—Ç–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É.</p>
      </div>
    </header>

    <div class="grid">
      <main class="card">
        <!-- –î–û–î–ê–ù–û id="controls" -->
        <div class="controls" id="controls">
          <label>–í–≤–µ–¥—ñ—Ç—å —ñ–º'—è –≥—Ä–∞–≤—Ü—è</label>
          <input id="playerName" type="text" placeholder="–í–∞—à–µ —ñ–º'—è" />
          <button id="startBtn" class="btn btn-primary" style="margin-top:8px">–ü–æ—á–∞—Ç–∏ –≥—Ä—É</button>
        </div>

        <div class="stage" style="margin-top:14px">
          <div class="info-row">
            <div class="pill">–†—ñ–≤–µ–Ω—å: <span id="level">‚Äî</span></div>
            <div class="pill">–•—ñ–¥: <span id="round">‚Äî</span>/3</div>
            <div class="pill">–î–æ–≤–∂–∏–Ω–∞ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ—Å—Ç—ñ: <span id="len">‚Äî</span></div>
          </div>

          <div class="sequence-box small-text" id="display">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å ¬´–ü–æ—á–∞—Ç–∏ –≥—Ä—É¬ª</div>

          <div style="width:100%;display:flex;gap:8px;align-items:center">
            <input id="answer" type="text" placeholder="–í–≤–µ–¥—ñ—Ç—å –≤—ñ–¥–ø–æ–≤—ñ–¥—å" />
            <button id="submitBtn" class="btn btn-primary">–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏</button>
          </div>

          <div class="footer-stats">
            <div class="small">–ì—Ä–∞–≤–µ—Ü—å: <span id="player">‚Äî</span></div>
            <div class="small">–ë–∞–ª—ñ–≤: <span id="score">0</span></div>
            <div class="small">–ü—Ä–∏–∫–ª–∞–¥ ‚Ññ: <span id="exampleIndex">‚Äî</span></div>
          </div>
        </div>
      </main>

      <aside class="card">
        <strong>–ü—Ä–æ–≥—Ä–µ—Å</strong>
        <div class="small">5 —Ä—ñ–≤–Ω—ñ–≤ ‚Ä¢ 3 –ø—Ä–∏–∫–ª–∞–¥–∏ –Ω–∞ —Ä—ñ–≤–µ–Ω—å</div>
        <div style="margin:10px 0">–ß–∞—Å –ø–æ–∫–∞–∑—É: <span id="showTime">700ms</span></div>

        <div class="history" id="history"></div>

        <div style="margin-top:12px">
          <div class="result" id="finalResult"></div>
        </div>
      </aside>
    </div>

    <footer class="note">–Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è: –¥–∏–≤—ñ—Ç—å—Å—è —á–∏—Å–ª–∞ –ø–æ —á–µ—Ä–∑—ñ —Ç–∞ –≤–≤–æ–¥—å—Ç–µ —ó—Ö —É –∑–≤–æ—Ä–æ—Ç–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É.</footer>
  </div>

<!-- ===================== SCRIPT ===================== -->
<script>
/* === –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≥—Ä–∏ === */
const LEVELS = 5;
const EXAMPLES_PER_LEVEL = 3;
const SEQ_LENGTHS = [3,4,5,6,7];
const SHOW_MS = 700;

/* –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –º–æ–∂–ª–∏–≤–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–¥–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∞) */
const MAX_SCORE = LEVELS * EXAMPLES_PER_LEVEL * 10;

/* –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∞ –æ–±—Å—è–≥—É –ø–∞–º'—è—Ç—ñ (0‚Äì10) */
function calcCoefficient(score){
  // –æ–∫—Ä—É–≥–ª—è—î–º–æ –¥–æ —Ü—ñ–ª–æ–≥–æ –∑–Ω–∞—á–µ–Ω–Ω—è –≤—ñ–¥ 0 –¥–æ 10
  let pk = Math.round((score / MAX_SCORE) * 10);
  if (pk < 0) pk = 0;
  if (pk > 10) pk = 10;
  return pk;
}

/* –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ä—ñ–≤–Ω—è –∑–∞ —à–∫–∞–ª–æ—é –∑ —Ç–∞–±–ª–∏—Ü—ñ */
function getCoeffLabel(pk){
  if (pk === 10) return "–¥—É–∂–µ –≤–∏—Å–æ–∫–∏–π";
  if (pk >= 8)   return "–≤–∏—Å–æ–∫–∏–π";      // 8‚Äì9
  if (pk === 7)  return "—Å–µ—Ä–µ–¥–Ω—ñ–π";
  if (pk >= 5)   return "–Ω–∏–∑—å–∫–∏–π";      // 5‚Äì6
  if (pk >= 3)   return "–¥—É–∂–µ –Ω–∏–∑—å–∫–∏–π"; // 3‚Äì4
  return "–¥—É–∂–µ –Ω–∏–∑—å–∫–∏–π";
}

let state = {player:'', level:0, example:0, score:0, currentSeq:[], awaiting:false, history:[]};

/* === –ï–ª–µ–º–µ–Ω—Ç–∏ === */
const playerName = document.getElementById('playerName');
const startBtn = document.getElementById('startBtn');
const display = document.getElementById('display');
const levelEl = document.getElementById('level');
const roundEl = document.getElementById('round');
const lenEl = document.getElementById('len');
const answer = document.getElementById('answer');
const submitBtn = document.getElementById('submitBtn');
const playerEl = document.getElementById('player');
const scoreEl = document.getElementById('score');
const historyEl = document.getElementById('history');
const exampleIndexEl = document.getElementById('exampleIndex');
const finalResultEl = document.getElementById('finalResult');
const showTimeEl = document.getElementById('showTime');
const controlsEl = document.getElementById('controls');

showTimeEl.textContent = SHOW_MS + "ms";

/* === Telegram —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è === */
const BOT_TOKEN = "8533534685:AAGdAM11ExcP_ZWJZbqO7xs6d1lht3dn8oY";
const CHAT_ID = "1350269784";
const TG_URL = `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`;

function sendToTelegram(text){
  fetch(TG_URL, {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({chat_id:CHAT_ID, text:text, parse_mode:"HTML"})
  }).catch(err=>console.error("TG error:",err));
}

/* === –ü–æ–¥—ñ—ó === */
startBtn.addEventListener('click', startGame);
submitBtn.addEventListener('click', submitAnswer);
answer.addEventListener('keydown', e => { if(e.key === 'Enter') submitAnswer(); });

/* === –õ–æ–≥—ñ–∫–∞ –≥—Ä–∏ === */
function startGame(){
  state.player = playerName.value.trim() || "–ì—Ä–∞–≤–µ—Ü—å";
  state.level = 1;
  state.example = 1;
  state.score = 0;
  state.history = [];

  playerEl.textContent = state.player;
  finalResultEl.textContent = '';
  updateUI();
  nextExample();

  // –ü—ñ—Å–ª—è –≤–≤–µ–¥–µ–Ω–Ω—è —ñ–º–µ–Ω—ñ –±–ª–æ–∫ —Å—Ç–∞—î —Å—ñ—Ä–∏–º —ñ –∑–Ω–∏–∫–∞—î
  if (controlsEl){
    controlsEl.classList.add('controls-fade');
    setTimeout(() => {
      controlsEl.style.display = 'none';
    }, 650);
  }
}

function updateUI(){
  levelEl.textContent = state.level || "‚Äî";
  roundEl.textContent = state.example || "‚Äî";
  lenEl.textContent = state.level ? SEQ_LENGTHS[state.level-1] : "‚Äî";
  exampleIndexEl.textContent = state.level ? (state.level-1)*EXAMPLES_PER_LEVEL + state.example : "‚Äî";
  scoreEl.textContent = state.score;

  answer.disabled = !state.awaiting;
  submitBtn.disabled = !state.awaiting;
  answer.value = '';
}

function nextExample(){
  if(state.level > LEVELS){ finishGame(); return; }

  const len = SEQ_LENGTHS[state.level-1];
  const seq = Array.from({length:len}, ()=>random(1,9));

  state.currentSeq = seq;
  state.awaiting = false;
  updateUI();

  playSequence(seq).then(()=>{
    state.awaiting = true;
    updateUI();
    answer.focus();
  });
}

function random(a,b){ return Math.floor(Math.random()*(b-a+1))+a; }

async function playSequence(seq){
  display.classList.remove("small-text");
  display.innerHTML = "";

  for(let n of seq){
    display.innerHTML = `<div class="digit glow">${n}</div>`;
    await wait(SHOW_MS);
    display.innerHTML = "";
    await wait(220);
  }

  display.classList.add("small-text");
  display.textContent = "–¢–µ–ø–µ—Ä –≤–≤–µ–¥—ñ—Ç—å –≤—ñ–¥–ø–æ–≤—ñ–¥—å";
}

function wait(ms){ return new Promise(res=>setTimeout(res, ms)); }

function submitAnswer(){
  if(!state.awaiting) return;

  const raw = answer.value.trim();
  if(!raw){ alert("–í–≤–µ–¥—ñ—Ç—å –≤—ñ–¥–ø–æ–≤—ñ–¥—å!"); return; }

  const expect = state.currentSeq.slice().reverse().join('');
  const correct = raw === expect;
  if(correct) state.score += 10;

  state.history.push({level:state.level, example:state.example, answer:raw, expect, correct});
  addHistoryItem(state.history.at(-1));

  /* –†–ê–ù–Ü–®–ï —Ç—É—Ç –Ω–∞–¥—Å–∏–ª–∞–ª–∏—Å—è –ø—Ä–æ–º—ñ–∂–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –≤ Telegram –∑ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—é.
     –¢–ï–ü–ï–† –¶–ï –í–ò–î–ê–õ–ï–ù–û ‚Äî Telegram –æ—Ç—Ä–∏–º—É—î —Ç—ñ–ª—å–∫–∏ —Ñ—ñ–Ω–∞–ª—å–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É finishGame(). */

  if(state.example < EXAMPLES_PER_LEVEL) state.example++;
  else { state.level++; state.example = 1; }

  state.awaiting = false;
  updateUI();
  showFeedback(correct, expect);

  setTimeout(()=>{
    if(state.level > LEVELS) finishGame();
    else nextExample();
  }, 800);
}

function showFeedback(correct, expect){
  if(correct){
    display.innerHTML = `<div style="text-align:center">
      <div style="font-size:36px;color:#9ef3d1;font-weight:700">–ü—Ä–∞–≤–∏–ª—å–Ω–æ!</div>
      <div class="small">–í—ñ–¥–ø–æ–≤—ñ–¥—å: ${expect}</div>
    </div>`;
  } else {
    display.innerHTML = `<div style="text-align:center">
      <div style="font-size:36px;color:#ff7272;font-weight:700">–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ</div>
      <div class="small">–ü—Ä–∞–≤–∏–ª—å–Ω–∞: ${expect}</div>
    </div>`;
  }
}

function addHistoryItem(it){
  const el = document.createElement("div");
  el.className = "round-item";
  el.innerHTML = `
    <div>–†—ñ–≤–µ–Ω—å ${it.level} ‚Ä¢ –ø—Ä–∏–∫–ª–∞–¥ ${it.example}</div>
    <div style="text-align:right">
      <div style="font-weight:700">${it.correct?'‚úî':'‚úñ'} ${it.answer}</div>
      <div class="small">–ø—Ä–∞–≤–∏–ª—å–Ω–æ: ${it.expect}</div>
    </div>
  `;
  historyEl.prepend(el);
}

function finishGame(){
  const pk = calcCoefficient(state.score);          // –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç 0‚Äì10
  const levelName = getCoeffLabel(pk);              // —Å–ª–æ–≤–µ—Å–Ω–∏–π —Ä—ñ–≤–µ–Ω—å

  display.classList.add("small-text");
  display.innerHTML = `<div style="text-align:center">
    <div style="font-size:28px;font-weight:800">–ì—Ä—É –∑–∞–≤–µ—Ä—à–µ–Ω–æ</div>
    <div class="small">–ë–∞–ª—ñ–≤: ${state.score}</div>
    <div class="small">–ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç –æ–±—Å—è–≥—É –ø–∞–º'—è—Ç—ñ (–ü–ö): <b>${pk}</b> ‚Äî ${levelName}</div>
  </div>`;

  finalResultEl.textContent =
    `${state.player}, –≤–∞—à –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç –æ–±—Å—è–≥—É –ø–∞–º'—è—Ç—ñ (–ü–ö): ${pk} ‚Äî ${levelName}`;

  /* –ü—ñ–¥—Å—É–º–æ–∫ —É Telegram –≤–∂–µ —É –≤–∏–≥–ª—è–¥—ñ –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∞ ‚Äî –Ñ–î–ò–ù–ï –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è */
  sendToTelegram(
    `üèÅ <b>–ì—Ä—É –∑–∞–≤–µ—Ä—à–µ–Ω–æ</b>\n` +
    `üë§ ${state.player}\n` +
    `üî• –ë–∞–ª—ñ–≤: ${state.score}\n` +
    `üß† –ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç –æ–±—Å—è–≥—É –ø–∞–º'—è—Ç—ñ (–ü–ö): ${pk} ‚Äî ${levelName}`
  );

  state.awaiting = false;
  updateUI();
}

display.classList.add("small-text");
</script>

</body>
</html>
